<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/template/geralRich.xhtml">

	<ui:define name="headComplementar">
		<script src="http://maps.google.com/maps/api/js?sensor=false"
			type="text/javascript"></script>
	</ui:define>

	<ui:define name="titulo">ÚLtima posição da frota</ui:define>

	<ui:define name="conteudo">
		<h:form id="form">

			<h:messages errorStyle="errorMsg" infoStyle="infoMsg" />

			<div style="float: left">

				<rich:dataTable value="#{posicaoFrotaMb.posicoes}" var="posicao">
					<f:facet name="header">Para focar em um veículo, clique sobre o mesmo</f:facet>
					<rich:column>
						<h:commandLink value="#{posicao.veiculo.identificacao}" 
							actionListener="#{posicaoFrotaMb.focar(posicao)}" title="Clique para focar no mapa">
							<f:ajax render=":form:mapa" />
						</h:commandLink>
					</rich:column>
					<rich:column>
						<h:outputText value="#{posicao.dataHora}">
							<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss" />
						</h:outputText>
					</rich:column>
					<rich:column>
						<h:outputText value="#{posicao.lat}" />
					</rich:column>
					<rich:column>
						<h:outputText value="#{posicao.lng}" />
					</rich:column>
				</rich:dataTable>
			</div>
			
			<p:gmap id="mapa" center="#{posicaoFrotaMb.centroMapa}"
				zoom="#{posicaoFrotaMb.zoomMapa}" type="HYBRID"
				style="height: 450px; width: 600px; border: 1px solid #c0c0d1; margin: auto"
				model="#{posicaoFrotaMb.mapModel}" widgetVar="mapa">
				<p:ajax event="stateChange" listener="#{posicaoFrotaMb.onStateChange}" />
			</p:gmap>
			
		</h:form>
	</ui:define>
</ui:composition>

